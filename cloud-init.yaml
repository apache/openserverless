#cloud-config
apt_update: true
apt_upgrade: true

users:
  - name: ubuntu
    uid: 1000
    groups: sudo
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']

write_files:
  - path: /etc/systemd/system/openserverless-setup.service
    permissions: '0644'
    content: |
      [Unit]
      Description=Initial setup
      After=cloud-init.target
      Requires=network-online.target
      After=network-online.target
      [Service]
      Type=oneshot
      Environment="HOME=/home/ubuntu"
      ExecStart=/etc/cloud-init.sh 
      User=ubuntu
      [Install]
      WantedBy=multi-user.target    

runcmd:
  - |
    curl -o  /etc/cloud-init.sh https://raw.githubusercontent.com/sciabarracom/openserverless/main/cloud-init.sh
    chmod +x "/etc/cloud-init.sh"
    # enable and start the service
    #systemctl enable openserverless-setup.service
    #systemctl start openserverless-setup.service